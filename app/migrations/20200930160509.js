const Promise = require('bluebird');
const mongo = require('../components/database/mongo');
const configuration = require('../components/configuration');

const currencies = [
  { name: 'Afghani', isoCode: 'AFN' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Lek', isoCode: 'ALL' },
  { name: 'Algerian Dinar', isoCode: 'DZD' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Kwanza', isoCode: 'AOA' },
  { name: 'East Caribbean Dollar', isoCode: 'XCD' },
  { name: 'No universal currency', isoCode: '' },
  { name: 'East Caribbean Dollar', isoCode: 'XCD' },
  { name: 'Argentine Peso', isoCode: 'ARS' },
  { name: 'Armenian Dram', isoCode: 'AMD' },
  { name: 'Aruban Florin', isoCode: 'AWG' },
  { name: 'Australian Dollar', isoCode: 'AUD' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Azerbaijan Manat', isoCode: 'AZN' },
  { name: 'Bahamian Dollar', isoCode: 'BSD' },
  { name: 'Bahraini Dinar', isoCode: 'BHD' },
  { name: 'Taka', isoCode: 'BDT' },
  { name: 'Barbados Dollar', isoCode: 'BBD' },
  { name: 'Belarusian Ruble', isoCode: 'BYN' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Belize Dollar', isoCode: 'BZD' },
  { name: 'CFA Franc BCEAO', isoCode: 'XOF' },
  { name: 'Bermudian Dollar', isoCode: 'BMD' },
  { name: 'Indian Rupee', isoCode: 'INR' },
  { name: 'Ngultrum', isoCode: 'BTN' },
  { name: 'Boliviano', isoCode: 'BOB' },
  { name: 'Mvdol', isoCode: 'BOV' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Convertible Mark', isoCode: 'BAM' },
  { name: 'Pula', isoCode: 'BWP' },
  { name: 'Norwegian Krone', isoCode: 'NOK' },
  { name: 'Brazilian Real', isoCode: 'BRL' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Brunei Dollar', isoCode: 'BND' },
  { name: 'Bulgarian Lev', isoCode: 'BGN' },
  { name: 'CFA Franc BCEAO', isoCode: 'XOF' },
  { name: 'Burundi Franc', isoCode: 'BIF' },
  { name: 'Cabo Verde Escudo', isoCode: 'CVE' },
  { name: 'Riel', isoCode: 'KHR' },
  { name: 'CFA Franc BEAC', isoCode: 'XAF' },
  { name: 'Canadian Dollar', isoCode: 'CAD' },
  { name: 'Cayman Islands Dollar', isoCode: 'KYD' },
  { name: 'CFA Franc BEAC', isoCode: 'XAF' },
  { name: 'CFA Franc BEAC', isoCode: 'XAF' },
  { name: 'Chilean Peso', isoCode: 'CLP' },
  { name: 'Unidad de Fomento', isoCode: 'CLF' },
  { name: 'Yuan Renminbi', isoCode: 'CNY' },
  { name: 'Australian Dollar', isoCode: 'AUD' },
  { name: 'Australian Dollar', isoCode: 'AUD' },
  { name: 'Colombian Peso', isoCode: 'COP' },
  { name: 'Unidad de Valor Real', isoCode: 'COU' },
  { name: 'Comorian Franc', isoCode: 'KMF' },
  { name: 'Congolese Franc', isoCode: 'CDF' },
  { name: 'CFA Franc BEAC', isoCode: 'XAF' },
  { name: 'New Zealand Dollar', isoCode: 'NZD' },
  { name: 'Costa Rican Colon', isoCode: 'CRC' },
  { name: 'CFA Franc BCEAO', isoCode: 'XOF' },
  { name: 'Kuna', isoCode: 'HRK' },
  { name: 'Cuban Peso', isoCode: 'CUP' },
  { name: 'Peso Convertible', isoCode: 'CUC' },
  { name: 'Netherlands Antillean Guilder', isoCode: 'ANG' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Czech Koruna', isoCode: 'CZK' },
  { name: 'Danish Krone', isoCode: 'DKK' },
  { name: 'Djibouti Franc', isoCode: 'DJF' },
  { name: 'East Caribbean Dollar', isoCode: 'XCD' },
  { name: 'Dominican Peso', isoCode: 'DOP' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Egyptian Pound', isoCode: 'EGP' },
  { name: 'El Salvador Colon', isoCode: 'SVC' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'CFA Franc BEAC', isoCode: 'XAF' },
  { name: 'Nakfa', isoCode: 'ERN' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Lilangeni', isoCode: 'SZL' },
  { name: 'Ethiopian Birr', isoCode: 'ETB' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Falkland Islands Pound', isoCode: 'FKP' },
  { name: 'Danish Krone', isoCode: 'DKK' },
  { name: 'Fiji Dollar', isoCode: 'FJD' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'CFP Franc', isoCode: 'XPF' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'CFA Franc BEAC', isoCode: 'XAF' },
  { name: 'Dalasi', isoCode: 'GMD' },
  { name: 'Lari', isoCode: 'GEL' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Ghana Cedi', isoCode: 'GHS' },
  { name: 'Gibraltar Pound', isoCode: 'GIP' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Danish Krone', isoCode: 'DKK' },
  { name: 'East Caribbean Dollar', isoCode: 'XCD' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Quetzal', isoCode: 'GTQ' },
  { name: 'Pound Sterling', isoCode: 'GBP' },
  { name: 'Guinean Franc', isoCode: 'GNF' },
  { name: 'CFA Franc BCEAO', isoCode: 'XOF' },
  { name: 'Guyana Dollar', isoCode: 'GYD' },
  { name: 'Gourde', isoCode: 'HTG' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Australian Dollar', isoCode: 'AUD' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Lempira', isoCode: 'HNL' },
  { name: 'Hong Kong Dollar', isoCode: 'HKD' },
  { name: 'Forint', isoCode: 'HUF' },
  { name: 'Iceland Krona', isoCode: 'ISK' },
  { name: 'Indian Rupee', isoCode: 'INR' },
  { name: 'Rupiah', isoCode: 'IDR' },
  { name: 'SDR (Special Drawing Right)', isoCode: 'XDR' },
  { name: 'Iranian Rial', isoCode: 'IRR' },
  { name: 'Iraqi Dinar', isoCode: 'IQD' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Pound Sterling', isoCode: 'GBP' },
  { name: 'New Israeli Sheqel', isoCode: 'ILS' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Jamaican Dollar', isoCode: 'JMD' },
  { name: 'Yen', isoCode: 'JPY' },
  { name: 'Pound Sterling', isoCode: 'GBP' },
  { name: 'Jordanian Dinar', isoCode: 'JOD' },
  { name: 'Tenge', isoCode: 'KZT' },
  { name: 'Kenyan Shilling', isoCode: 'KES' },
  { name: 'Australian Dollar', isoCode: 'AUD' },
  { name: 'North Korean Won', isoCode: 'KPW' },
  { name: 'Won', isoCode: 'KRW' },
  { name: 'Kuwaiti Dinar', isoCode: 'KWD' },
  { name: 'Som', isoCode: 'KGS' },
  { name: 'Lao Kip', isoCode: 'LAK' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Lebanese Pound', isoCode: 'LBP' },
  { name: 'Loti', isoCode: 'LSL' },
  { name: 'Rand', isoCode: 'ZAR' },
  { name: 'Liberian Dollar', isoCode: 'LRD' },
  { name: 'Libyan Dinar', isoCode: 'LYD' },
  { name: 'Swiss Franc', isoCode: 'CHF' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Pataca', isoCode: 'MOP' },
  { name: 'Denar', isoCode: 'MKD' },
  { name: 'Malagasy Ariary', isoCode: 'MGA' },
  { name: 'Malawi Kwacha', isoCode: 'MWK' },
  { name: 'Malaysian Ringgit', isoCode: 'MYR' },
  { name: 'Rufiyaa', isoCode: 'MVR' },
  { name: 'CFA Franc BCEAO', isoCode: 'XOF' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Ouguiya', isoCode: 'MRU' },
  { name: 'Mauritius Rupee', isoCode: 'MUR' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'ADB Unit of Account', isoCode: 'XUA' },
  { name: 'Mexican Peso', isoCode: 'MXN' },
  { name: 'Mexican Unidad de Inversion (UDI)', isoCode: 'MXV' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Moldovan Leu', isoCode: 'MDL' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Tugrik', isoCode: 'MNT' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'East Caribbean Dollar', isoCode: 'XCD' },
  { name: 'Moroccan Dirham', isoCode: 'MAD' },
  { name: 'Mozambique Metical', isoCode: 'MZN' },
  { name: 'Kyat', isoCode: 'MMK' },
  { name: 'Namibia Dollar', isoCode: 'NAD' },
  { name: 'Rand', isoCode: 'ZAR' },
  { name: 'Australian Dollar', isoCode: 'AUD' },
  { name: 'Nepalese Rupee', isoCode: 'NPR' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'CFP Franc', isoCode: 'XPF' },
  { name: 'New Zealand Dollar', isoCode: 'NZD' },
  { name: 'Cordoba Oro', isoCode: 'NIO' },
  { name: 'CFA Franc BCEAO', isoCode: 'XOF' },
  { name: 'Naira', isoCode: 'NGN' },
  { name: 'New Zealand Dollar', isoCode: 'NZD' },
  { name: 'Australian Dollar', isoCode: 'AUD' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Norwegian Krone', isoCode: 'NOK' },
  { name: 'Rial Omani', isoCode: 'OMR' },
  { name: 'Pakistan Rupee', isoCode: 'PKR' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'No universal currency', isoCode: '' },
  { name: 'Balboa', isoCode: 'PAB' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Kina', isoCode: 'PGK' },
  { name: 'Guarani', isoCode: 'PYG' },
  { name: 'Sol', isoCode: 'PEN' },
  { name: 'Philippine Peso', isoCode: 'PHP' },
  { name: 'New Zealand Dollar', isoCode: 'NZD' },
  { name: 'Zloty', isoCode: 'PLN' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Qatari Rial', isoCode: 'QAR' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Romanian Leu', isoCode: 'RON' },
  { name: 'Russian Ruble', isoCode: 'RUB' },
  { name: 'Rwanda Franc', isoCode: 'RWF' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Saint Helena Pound', isoCode: 'SHP' },
  { name: 'East Caribbean Dollar', isoCode: 'XCD' },
  { name: 'East Caribbean Dollar', isoCode: 'XCD' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'East Caribbean Dollar', isoCode: 'XCD' },
  { name: 'Tala', isoCode: 'WST' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Dobra', isoCode: 'STN' },
  { name: 'Saudi Riyal', isoCode: 'SAR' },
  { name: 'CFA Franc BCEAO', isoCode: 'XOF' },
  { name: 'Serbian Dinar', isoCode: 'RSD' },
  { name: 'Seychelles Rupee', isoCode: 'SCR' },
  { name: 'Leone', isoCode: 'SLL' },
  { name: 'Singapore Dollar', isoCode: 'SGD' },
  { name: 'Netherlands Antillean Guilder', isoCode: 'ANG' },
  { name: 'Sucre', isoCode: 'XSU' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Solomon Islands Dollar', isoCode: 'SBD' },
  { name: 'Somali Shilling', isoCode: 'SOS' },
  { name: 'Rand', isoCode: 'ZAR' },
  { name: 'No universal currency', isoCode: '' },
  { name: 'South Sudanese Pound', isoCode: 'SSP' },
  { name: 'Euro', isoCode: 'EUR' },
  { name: 'Sri Lanka Rupee', isoCode: 'LKR' },
  { name: 'Sudanese Pound', isoCode: 'SDG' },
  { name: 'Surinam Dollar', isoCode: 'SRD' },
  { name: 'Norwegian Krone', isoCode: 'NOK' },
  { name: 'Swedish Krona', isoCode: 'SEK' },
  { name: 'Swiss Franc', isoCode: 'CHF' },
  { name: 'WIR Euro', isoCode: 'CHE' },
  { name: 'WIR Franc', isoCode: 'CHW' },
  { name: 'Syrian Pound', isoCode: 'SYP' },
  { name: 'New Taiwan Dollar', isoCode: 'TWD' },
  { name: 'Somoni', isoCode: 'TJS' },
  { name: 'Tanzanian Shilling', isoCode: 'TZS' },
  { name: 'Baht', isoCode: 'THB' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'CFA Franc BCEAO', isoCode: 'XOF' },
  { name: 'New Zealand Dollar', isoCode: 'NZD' },
  { name: 'Pa’anga', isoCode: 'TOP' },
  { name: 'Trinidad and Tobago Dollar', isoCode: 'TTD' },
  { name: 'Tunisian Dinar', isoCode: 'TND' },
  { name: 'Turkish Lira', isoCode: 'TRY' },
  { name: 'Turkmenistan New Manat', isoCode: 'TMT' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'Australian Dollar', isoCode: 'AUD' },
  { name: 'Uganda Shilling', isoCode: 'UGX' },
  { name: 'Hryvnia', isoCode: 'UAH' },
  { name: 'UAE Dirham', isoCode: 'AED' },
  { name: 'Pound Sterling', isoCode: 'GBP' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'US Dollar (Next day)', isoCode: 'USN' },
  { name: 'Peso Uruguayo', isoCode: 'UYU' },
  { name: 'Uruguay Peso en Unidades Indexadas (UI)', isoCode: 'UYI' },
  { name: 'Unidad Previsional', isoCode: 'UYW' },
  { name: 'Uzbekistan Sum', isoCode: 'UZS' },
  { name: 'Vatu', isoCode: 'VUV' },
  { name: 'Bolívar Soberano', isoCode: 'VES' },
  { name: 'Dong', isoCode: 'VND' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'US Dollar', isoCode: 'USD' },
  { name: 'CFP Franc', isoCode: 'XPF' },
  { name: 'Moroccan Dirham', isoCode: 'MAD' },
  { name: 'Yemeni Rial', isoCode: 'YER' },
  { name: 'Zambian Kwacha', isoCode: 'ZMW' },
  { name: 'Zimbabwe Dollar', isoCode: 'ZWL' },
  { name: 'Bond Markets Unit European Composite Unit (EURCO)', isoCode: 'XBA' },
  { name: 'Bond Markets Unit European Monetary Unit (E.M.U.-6)', isoCode: 'XBB' },
  { name: 'Bond Markets Unit European Unit of Account 9 (E.U.A.-9)', isoCode: 'XBC' },
  { name: 'Bond Markets Unit European Unit of Account 17 (E.U.A.-17)', isoCode: 'XBD' },
  { name: 'Codes specifically reserved for testing purposes', isoCode: 'XTS' },
  { name: 'The codes assigned for transactions where no currency is involved', isoCode: 'XXX' },
  { name: 'Gold', isoCode: 'XAU' },
  { name: 'Palladium', isoCode: 'XPD' },
  { name: 'Platinum', isoCode: 'XPT' },
  { name: 'Silver', isoCode: 'XAG' },
];

const migration = () => mongo.connect(configuration)
  .then(connections => connections.mongoose.connection)
  .then((db) => {
    const lspCol = db.collection('lsp');
    const currencyCol = db.collection('currencies');
    return lspCol.find({}, { _id: 1 }).toArray()
      .then(lsps =>
        Promise.mapSeries(lsps, lsp =>
          Promise.map(currencies, ({ name, isoCode }) =>
            currencyCol.update(
              { isoCode, name, lspId: lsp._id },
              { $set: { name } },
              { upsert: true },
            ),
          ),
        ),
      );
  });

if (require.main === module) {
  migration().then(() => process.exit(0)).catch((err) => { throw err; });
} else {
  module.exports = migration;
}
